"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useVideo = void 0;
const react_1 = require("react");
const CompositionManagerContext_js_1 = require("./CompositionManagerContext.js");
const ResolveCompositionConfig_js_1 = require("./ResolveCompositionConfig.js");
const useVideo = () => {
    const context = (0, react_1.useContext)(CompositionManagerContext_js_1.CompositionManager);
    const selected = context.compositions.find((c) => {
        return c.id === context.currentComposition;
    });
    const resolved = (0, ResolveCompositionConfig_js_1.useResolvedVideoConfig)(context.currentComposition);
    return (0, react_1.useMemo)(() => {
        var _a, _b;
        if (!resolved) {
            return null;
        }
        if (resolved.type === 'error') {
            return null;
        }
        if (resolved.type === 'loading') {
            return null;
        }
        if (!selected) {
            return null;
        }
        return {
            ...resolved.result,
            defaultProps: (_a = selected.defaultProps) !== null && _a !== void 0 ? _a : {},
            id: selected.id,
            // We override the selected metadata with the metadata that was passed to renderMedia(),
            // and don't allow it to be changed during render anymore
            ...((_b = context.currentCompositionMetadata) !== null && _b !== void 0 ? _b : {}),
            component: selected.component,
        };
    }, [context.currentCompositionMetadata, resolved, selected]);
};
exports.useVideo = useVideo;
